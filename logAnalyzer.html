<!doctype html>
<html lang="ja">
  <head>
    <title>Squve</title>
    <meta charset="UTF-8">

    <!-- 共通 -->
    <link rel="stylesheet" href="./libs/jquery-ui/1.11.0/jquery-ui.min.css" />
    <script src="./libs/jquery/jquery-2.1.1.min.js"></script>
    <script src="./libs/jquery-ui/1.11.0/jquery-ui.min.js"></script>
    <script src="./libs/jquery-utils/jquery.dataTables.js"></script>
    <script src="./libs/jquery-utils/jquery.easing.1.3.min.js"></script>
    <script src="./libs/jquery-utils/jquery.mousewheel.js"></script>
    <script src="./libs/jquery-utils/jquery.widget.min.js"></script>

    <!-- Metro UI CSS -->
    <script src="./libs/Metro-UI-CSS/metro.min.js"></script>
    <link rel="stylesheet" href="./libs/Metro-UI-CSS/iconfont.min.css" />
    <link rel="stylesheet" href="./libs/Metro-UI-CSS/metro-bootstrap.min.css" />
    <link rel="stylesheet" href="./libs/Metro-UI-CSS/metro-bootstrap-responsive.min.css" />

    <!-- Hands on Table -->
    <script src="./libs/jquery-handsontable/jquery.handsontable.full.js"></script>
    <link rel="stylesheet" media="screen" href="./libs/jquery-handsontable/jquery.handsontable.full.css">

    <!-- aa -->
    <!-- エラーの原因なのでとりあえずコメントアウト
    <script src="data/js/menu.js"></script>
    -->
    <script src="data/js/dev.js"></script>

    <script src="data/js/main.js"></script>
  </head>
  <body class="metro">

    <a id="load" class="button large">ログファイルをロード</a>
    <input id="import_file" type="file" style="display:none"/>

    <script type="text/javascript">
      var fs = require("fs");
      var readline = require("readline");

      function chooseFile (name) {
        var chooser = $(name);
        chooser.change( function (evt) {
          //
          var tmpStr = '';

          //
          var path = $(this).val();
          var rs = fs.ReadStream(path);
          var rl = readline.createInterface({'input': rs, 'output': tmpStr});
          var i = 0;

          rl.on('line', function (line) {
            tmpStr = tmpStr + line.trim() + "<br />";
            console.debug(++i + ':' + line.trim());

            //下記は失敗例
            //tmpStr = line.trim() + "<br />";
            //rl.setPrompt(tmpStr, tmpStr.length);
            //rl.prompt();
          });
          rl.resume();

          console.debug(tmpStr);
          $('#logs').text(tmpStr);
        });
        chooser.trigger('click');
      }
    $('#load').on('click', function() {
        chooseFile('#import_file');
    });
    </script>

    <h2>Logs</h2>
    <div id="logs"></div>

  </body>
</html>
